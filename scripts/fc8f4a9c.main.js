$(function(){"use strict";function a(a){k&&(k.src=a,k.play())}function b(a){function c(){e=null,a.removeClass("active"),l.off("mousemove"),l.off("click")}var e,f;a.off("click"),a.on("click",function(g){var h,k;a!==e&&(a.hasClass("freeze")?(f=!0,j.pop(),j.length>0?(i=j[j.length-1],b(j[j.length-1]),i.addClass("last")):i=$(".train"),a.removeClass("freeze")):f=!1,h=g.pageX,k=g.pageY,a.addClass("active"),e=a,g.stopPropagation(),l.on("mousemove",function(b){var e=a.position();a.css({top:e.top+b.pageY-k+"px",left:e.left+b.pageX-h+"px"}),h=b.pageX,k=b.pageY,f||d(a,c)}),l.on("click",function(){f&&d(a,c),c()}))})}function c(a){var b=a.position(),c=i.position(),d=a.height(),e=i.width(),f=i.height(),g=b.left+p,h=b.top+p,j=h+d-p,k=c.left+p,l=k+e-p,m=c.top+p,n=m+f-p;return g>=l-p&&l+p>=g&&(h>=m&&n>=h||j>=m&&n>=j)?!0:!1}function d(b,d){if(c(b)){d();var e;j.length>0?(e=o,j[j.length-1].off("click").removeClass("last")):e=n,j.push(b),b.addClass("freeze last");var f=i.position();f.top+=e.top,f.left+=e.left,b.css({top:f.top,left:f.left}),i=b,a(q)}}function e(){$(".final").hide(),i=$(".train"),j=[],$(".train").removeClass("tr1 tr2 tr3 tr4 tr5").addClass("clickable tr"+m).css({left:"calc(50% - "+(150+150*m)/2+"px)"}),$(".wagon").css({top:"",left:""}).removeClass("freeze").removeClass("active").each(function(){b($(this))})}function f(){$(".banner").hide(),$(".wagon").addClass("visible"),e()}function g(){var a=$(".final");if(!a.data("active")){a.data("active",!0);var b=$(".final > div");b=b.css("padding-left","100%").detach(),console.log(b.length),$("#btnagain").css("visibility","hidden");var c,d,e,f,g=[0,1,2,3,4];for(c=0;50>c;c++)d=Math.floor(Math.random()*g.length),e=Math.floor(Math.random()*g.length),f=g[e],g[e]=g[d],g[d]=f;for(c=0;5>c;c++)a.append(b[g[c]]);a.show(),h($(".final > div").first())}}function h(b){a(s),b.animate({"padding-left":"1%"},3.3*l.width(),function(){var a=b.next("div");a.length>0?h(a):($(".final").data("active",!1),$("#btnagain").css("visibility","visible"))})}var i,j,k,l=$(window),m=1,n={top:18,left:140},o={top:0,left:136},p=20,q="sound/receive.wav",r="sound/youcannot.wav",s="sound/train.wav";Audio&&(k=new Audio),$(".train").on("click",function(){if($(".train").hasClass("clickable"))if(j.length===m){m++,m>5&&(m=1),$(".wagon").off("click");var b=i.position().left+i.width();a(s),$(".train").removeClass("clickable").add(".freeze").animate({left:"-="+b},3.3*b,function(){1===m?g():e()})}else a(r)}),$("#btnstart").on("click",f),$("#btnagain").on("click",e)});